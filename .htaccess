RewriteEngine On
RewriteBase /


RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]


RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

# Redirigir todas las solicitudes a index.php
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-l
RewriteRule ^(.*)$ index.php/$1 [L]

Options -Indexes

##Seguridad contra ataques xss y csrx
Header always set X-Frame-Options "ALLOW-FROM https://www.transparencia.gob.pe/"
Header set X-XSS-Protection "1; mode=block"
Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"


RewriteRule ^controller/ - [F,L]
RewriteRule ^model/ - [F,L]
RewriteRule ^log/ - [F,L]

<IfModule mod_deflate.c>
    # Habilitar compresión Gzip solo si el cliente lo admite
    <IfModule mod_filter.c>
    	AddOutputFilterByType DEFLATE text/plain
    	AddOutputFilterByType DEFLATE text/html
    	AddOutputFilterByType DEFLATE text/css
    	AddOutputFilterByType DEFLATE text/javascript
    	AddOutputFilterByType DEFLATE application/javascript
    	AddOutputFilterByType DEFLATE application/x-javascript
    	AddOutputFilterByType DEFLATE application/xml
    	AddOutputFilterByType DEFLATE application/xhtml+xml
    	AddOutputFilterByType DEFLATE application/rss+xml
    	AddOutputFilterByType DEFLATE application/atom+xml
    	AddOutputFilterByType DEFLATE application/json
    	AddOutputFilterByType DEFLATE application/ld+json
    	AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
    	AddOutputFilterByType DEFLATE application/x-font-ttf
    	AddOutputFilterByType DEFLATE application/x-font-opentype
    	AddOutputFilterByType DEFLATE application/x-font-woff
    	AddOutputFilterByType DEFLATE image/svg+xml
        <IfModule mod_setenvif.c>
            BrowserMatch ^Mozilla/4 gzip-only-text/html
            BrowserMatch ^Mozilla/4\.0[678] no-gzip
            BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
        </IfModule>
    </IfModule>

    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip
    SetEnvIfNoCase Request_URI \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip
    SetEnvIfNoCase Request_URI \.pdf$ no-gzip
    DeflateCompressionLevel 8

</IfModule>

<IfModule mod_headers.c>
    # Añadir cabecera Vary para indicar la compresión
    Header append Vary: Accept-Encoding
</IfModule>
